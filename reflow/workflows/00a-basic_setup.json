{
  "workflow_metadata": {
    "workflow_id": "00a-basic_setup",
    "name": "Basic Setup Workflow",
    "version": "3.7.0",
    "description": "Initialize system, configure paths, set up environment and foundational documents (framework selection separate)",
    "created_from": "00-setup.json v1.0.0 - S-01A (framework selection) extracted",
    "last_updated": "2025-10-27",
    "purpose": "Establish prerequisites for architecture workflows - fast setup without detailed framework analysis",
    "context_reduction": "Reduced from 1,102 lines to ~600 lines (45% reduction)"
  },
  "path_configuration": {
    "description": "Critical path setup - all paths must be absolute for tool invocations",
    "required_paths": {
      "reflow_root": {
        "description": "Where reflow tooling is installed (e.g., /home/user/dev/reflow)",
        "must_contain": [
          "tools/",
          "templates/",
          "definitions/",
          "workflows/",
          "workflow_steps/"
        ],
        "verification": "Check for presence of core directories",
        "stored_in": "system context/working_memory.json"
      },
      "system_root": {
        "description": "Where the system being developed is located (e.g., /home/user/projects/my_system)",
        "must_contain": [
          "context/",
          "specs/",
          "docs/"
        ],
        "created_by": "This workflow",
        "stored_in": "system context/working_memory.json"
      },
      "workflow_steps_path": {
        "description": "Path to workflow step definitions",
        "default": "{reflow_root}/workflow_steps",
        "stored_in": "system context/working_memory.json"
      },
      "tools_path": {
        "description": "Path to reflow tools",
        "default": "{reflow_root}/tools",
        "stored_in": "system context/working_memory.json"
      },
      "templates_path": {
        "description": "Path to reflow templates",
        "default": "{reflow_root}/templates",
        "stored_in": "system context/working_memory.json"
      }
    },
    "path_best_practices": [
      "Store reflow tools in one location (e.g., ~/dev/reflow/)",
      "Store each system in its own location (e.g., ~/projects/system_name/)",
      "Use absolute paths when invoking tools to avoid confusion",
      "Within system files, always use relative paths for portability",
      "Never assume systems are in reflow/systems/ directory"
    ]
  },
  "entry_points": {
    "new_system": {
      "id": "new_system",
      "description": "Starting a brand new system or concept",
      "trigger": "User wants to create a new system from scratch",
      "first_step": "S-01"
    },
    "new_concept_or_system": {
      "id": "new_concept_or_system",
      "description": "New concept that may become one or more systems",
      "trigger": "User has a new idea to develop",
      "first_step": "S-01"
    },
    "system_of_systems": {
      "id": "system_of_systems",
      "description": "Multi-system integration project",
      "trigger": "User wants to create a system-of-systems architecture",
      "first_step": "S-01",
      "optional_step": "S-04"
    }
  },
  "prerequisites": {},
  "workflow_steps": [
    {
      "step_id": "S-01",
      "name": "Path Configuration",
      "description": "Configure all required paths for reflow operation",
      "phase": "initialization",
      "step_file": "workflow_steps/setup/S-01-PathConfiguration.json",
      "actions": [
        {
          "action_id": "S-01-A01",
          "description": "Identify and validate reflow_root path",
          "verification": "Ensure reflow_root contains tools/, templates/, definitions/, workflows/",
          "store_in": "context/working_memory.json under paths.reflow_root"
        },
        {
          "action_id": "S-01-A02",
          "description": "Identify or create system_root path",
          "verification": "Confirm system directory exists or create it",
          "store_in": "context/working_memory.json under paths.system_root"
        },
        {
          "action_id": "S-01-A03",
          "description": "Derive and store all tool paths",
          "details": "Calculate paths.tools_path, paths.templates_path, paths.workflow_steps_path, paths.definitions_path",
          "store_in": "context/working_memory.json"
        },
        {
          "action_id": "S-01-A04",
          "description": "Run validate_reflow_setup.py",
          "command_pattern": "python3 {reflow_root}/tools/validate_reflow_setup.py {system_root}",
          "success_criteria": "All validation checks pass"
        }
      ],
      "tools_used": [
        "validate_reflow_setup.py"
      ],
      "outputs": [
        "context/working_memory.json with complete path configuration"
      ],
      "gates": [],
      "next_step": "S-02"
    },
    {
      "step_id": "S-02",
      "name": "Directory Structure Creation",
      "description": "Create standard system directory structure",
      "phase": "initialization",
      "step_file": "workflow_steps/setup/S-02-DirectoryStructure.json",
      "actions": [
        {
          "action_id": "S-02-A01",
          "description": "Create context/ directory",
          "purpose": "Store LLM agent tracking files (working_memory.json, step_progress_tracker.json, current_focus.md)",
          "command": "mkdir -p {system_root}/context"
        },
        {
          "action_id": "S-02-A02",
          "description": "Create specs/ directory structure",
          "purpose": "Store machine and human-readable specifications",
          "command": "mkdir -p {system_root}/specs/{machine,human}/{service_arch,interfaces,graphs,visualizations,documentation,reports}"
        },
        {
          "action_id": "S-02-A03",
          "description": "Create services/ directory",
          "purpose": "Store service implementations",
          "command": "mkdir -p {system_root}/services"
        },
        {
          "action_id": "S-02-A04",
          "description": "Create docs/ directory",
          "purpose": "Store foundational documents and system documentation",
          "command": "mkdir -p {system_root}/docs"
        },
        {
          "action_id": "S-02-A05",
          "description": "Run validate_directory_structure.py",
          "command_pattern": "python3 {reflow_root}/tools/validate_directory_structure.py {system_root}",
          "success_criteria": "All required directories exist"
        }
      ],
      "tools_used": [
        "validate_directory_structure.py"
      ],
      "outputs": [
        "Complete system directory structure"
      ],
      "gates": [],
      "next_step": "S-03"
    },
    {
      "step_id": "S-03",
      "name": "Foundational Documents",
      "description": "Create or validate foundational system documents",
      "phase": "initialization",
      "step_file": "workflow_steps/setup/S-03-FoundationalDocuments.json",
      "actions": [
        {
          "action_id": "S-03-A01",
          "description": "Create or validate SYSTEM_MISSION_STATEMENT.md",
          "location": "docs/SYSTEM_MISSION_STATEMENT.md",
          "content_requirements": [
            "Clear statement of system purpose",
            "Primary objectives",
            "Key stakeholders",
            "Success criteria at high level"
          ]
        },
        {
          "action_id": "S-03-A02",
          "description": "Create or validate USER_SCENARIOS.md",
          "location": "docs/USER_SCENARIOS.md",
          "content_requirements": [
            "Detailed user scenarios",
            "User personas",
            "Use cases",
            "User journey maps"
          ]
        },
        {
          "action_id": "S-03-A03",
          "description": "Create or validate SUCCESS_CRITERIA.md",
          "location": "docs/SUCCESS_CRITERIA.md",
          "content_requirements": [
            "Measurable success criteria",
            "Performance requirements",
            "Functional requirements",
            "Non-functional requirements"
          ]
        },
        {
          "action_id": "S-03-A04",
          "description": "Initialize working_memory.json",
          "tool": "bootstrap_development_context.py",
          "command_pattern": "python3 {reflow_root}/tools/bootstrap_development_context.py {system_root}",
          "creates": [
            "context/working_memory.json",
            "context/step_progress_tracker.json",
            "context/current_focus.md"
          ]
        },
        {
          "action_id": "S-03-A05",
          "description": "Initialize RAG-Enhanced Context Management (OPTIONAL but RECOMMENDED)",
          "purpose": "Set up automatic context retrieval to prevent drift and enforce workflow adherence",
          "tool": "generate_rag_embeddings.py",
          "optional": true,
          "recommended": "Strongly recommended to prevent context drift and systematic workflow enforcement",
          "setup_steps": [
            {
              "step": 1,
              "action": "Install RAG dependencies",
              "command": "pip install sentence-transformers faiss-cpu numpy",
              "check": "python3 -c 'import sentence_transformers, faiss, numpy'"
            },
            {
              "step": 2,
              "action": "Copy RAG configuration template",
              "command": "cp {reflow_root}/templates/rag_context_config_template.json {system_root}/context/rag_context_config.json"
            },
            {
              "step": 3,
              "action": "Edit RAG config and set system_name",
              "file": "{system_root}/context/rag_context_config.json",
              "update": "Set system_name field to match actual system name"
            },
            {
              "step": 4,
              "action": "Generate embeddings for knowledge bases",
              "command": "python3 {reflow_root}/tools/generate_rag_embeddings.py {system_root}",
              "creates": [
                "context/embeddings/decision_flow_embeddings.pkl",
                "context/embeddings/workflow_steps_embeddings.pkl",
                "context/embeddings/tool_reference_embeddings.pkl",
                "context/embeddings/architectural_definitions_embeddings.pkl",
                "context/embeddings/generation_summary.json"
              ],
              "duration": "1-3 minutes depending on workflow size"
            },
            {
              "step": 5,
              "action": "Verify RAG setup",
              "command": "cat {system_root}/context/embeddings/generation_summary.json",
              "success_criteria": "All knowledge bases generated successfully"
            }
          ],
          "benefits": [
            "Automatic context injection based on workflow state",
            "Degradation detection (report generation, workflow violations)",
            "Systematic enforcement of critical behavioral rules",
            "Token-efficient context retrieval (2000-8000 tokens vs 5000-10000 manual)",
            "Prevents LLM agents from forgetting workflow instructions"
          ],
          "rag_features": {
            "knowledge_bases": [
              "decision_flow_kb (workflow instructions and critical rules)",
              "workflow_steps_kb (step-specific guidance)",
              "tool_reference_kb (tool documentation)",
              "architectural_definitions_kb (UAF 1.2 terms)",
              "system_context_kb (runtime state)"
            ],
            "retrieval_strategies": [
              "on_step_start - Load workflow instructions for current step",
              "on_degradation_detected - Inject corrective context",
              "on_tool_execution - Load tool usage documentation",
              "on_user_query - Semantic search across all knowledge bases",
              "periodic_refresh - Auto-refresh every 4 operations or 12 minutes"
            ],
            "degradation_patterns": [
              "report_generation_attempt - Detects unwanted report generation",
              "workflow_violation - Detects skipping steps or ignoring workflow",
              "system_isolation_breach - Detects wrong directory or cross-system access",
              "context_confusion - Detects forgetting system name or current step"
            ]
          },
          "usage_in_workflows": {
            "manual_mode": "LLM agent manually reads working_memory.json and current_focus.md",
            "rag_enhanced_mode": "Use rag_agent_wrapper.py to automatically inject relevant context",
            "example": "python3 {reflow_root}/tools/rag_agent_wrapper.py {system_root} wrap --query 'Start next step' --strategy on_step_start"
          },
          "reference": "See {reflow_root}/docs/RAG_CONTEXT_MANAGEMENT.md for complete documentation"
        },
        {
          "action_id": "S-03-A06",
          "description": "Configure automatic git commits (OPTIONAL but RECOMMENDED)",
          "purpose": "Enable automatic version control commits at key workflow milestones",
          "user_prompt": {
            "ask": "Would you like to enable automatic git commits during workflow execution?",
            "options": [
              "Yes - Enable automatic git commits and pushes (recommended for version control)",
              "No - I'll manage git manually"
            ],
            "default": "No",
            "benefits": [
              "Automatic backup of architecture and code",
              "Version history of workflow progress",
              "Collaboration (others can see progress)",
              "Recovery from failures",
              "Meaningful commit messages at logical checkpoints"
            ]
          },
          "if_yes": {
            "git_setup": [
              {
                "step": 1,
                "action": "Check if git repo exists",
                "command": "cd {system_root} && git status",
                "outcomes": {
                  "success": "Git repo already exists, skip initialization",
                  "failure": "No git repo, proceed with initialization"
                }
              },
              {
                "step": 2,
                "action": "Initialize git repo if needed",
                "command": "cd {system_root} && git init",
                "condition": "Only if step 1 failed (no existing repo)"
              },
              {
                "step": 3,
                "action": "Create .gitignore file",
                "location": "{system_root}/.gitignore",
                "content": [
                  "# Python",
                  "__pycache__/",
                  "*.py[cod]",
                  "*$py.class",
                  "*.so",
                  ".Python",
                  "venv/",
                  "env/",
                  ".venv",
                  "*.egg-info/",
                  "",
                  "# IDEs",
                  ".vscode/",
                  ".idea/",
                  "*.swp",
                  "*.swo",
                  "*~",
                  "",
                  "# OS",
                  ".DS_Store",
                  "Thumbs.db",
                  "",
                  "# Secrets",
                  ".env",
                  "*.pem",
                  "*.key",
                  "credentials.json",
                  "",
                  "# Build artifacts",
                  "dist/",
                  "build/",
                  "*.egg",
                  "",
                  "# Test coverage",
                  ".coverage",
                  "htmlcov/",
                  "",
                  "# RAG embeddings (optional - large files)",
                  "# context/embeddings/*.pkl",
                  "",
                  "# Logs",
                  "*.log"
                ]
              },
              {
                "step": 4,
                "action": "Collect git configuration from user",
                "user_questions": [
                  {
                    "question": "What is your git remote repository URL?",
                    "examples": [
                      "https://github.com/username/repo.git",
                      "git@github.com:username/repo.git",
                      "https://gitlab.com/username/repo.git"
                    ],
                    "validation": "URL should end with .git",
                    "store_in": "context/git_config.json (git_remote_url)"
                  },
                  {
                    "question": "Which branch should automatic commits push to?",
                    "default": "main",
                    "examples": [
                      "main",
                      "develop",
                      "architecture",
                      "feature/workflow-automation"
                    ],
                    "store_in": "context/git_config.json (git_branch)"
                  },
                  {
                    "question": "Who should be credited as author for automatic commits?",
                    "default": "Claude Code <noreply@anthropic.com>",
                    "format": "Name <email>",
                    "examples": [
                      "Claude Code <noreply@anthropic.com>",
                      "Your Name <your@email.com>"
                    ],
                    "store_in": "context/git_config.json (git_author)"
                  }
                ]
              },
              {
                "step": 5,
                "action": "Configure git remote",
                "command": "cd {system_root} && git remote add origin {git_remote_url}",
                "fallback_if_exists": "git remote set-url origin {git_remote_url}",
                "verification": "git remote -v shows correct remote"
              },
              {
                "step": 6,
                "action": "Create initial git commit for setup",
                "commands": [
                  "cd {system_root}",
                  "git add .",
                  "git commit -m \"$(cat <<'EOF'\nInitial setup: Directory structure and foundational documents\n\n- Created directory structure (context/, specs/, docs/, services/)\n- Added foundational documents (SYSTEM_MISSION_STATEMENT.md, USER_SCENARIOS.md, SUCCESS_CRITERIA.md)\n- Initialized working_memory.json and workflow tracking\n- Configured automatic git commits\n\n\ud83e\udd16 Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>\nEOF\n)\"",
                  "git branch -M {git_branch}",
                  "git push -u origin {git_branch}"
                ],
                "error_handling": {
                  "if_push_fails": "Warn user but continue - they may need to configure git credentials or set up SSH keys",
                  "credential_help": "For HTTPS: git config --global credential.helper store\nFor SSH: Set up SSH keys with ssh-keygen and add to GitHub/GitLab",
                  "continue_on_failure": true
                }
              },
              {
                "step": 7,
                "action": "Save git configuration to working_memory.json",
                "update_fields": {
                  "git_automation_enabled": true,
                  "git_remote_url": "{git_remote_url}",
                  "git_branch": "{git_branch}",
                  "git_author": "{git_author}",
                  "last_git_commit": "{timestamp}"
                },
                "location": "context/working_memory.json"
              },
              {
                "step": 8,
                "action": "Create git commit helper function documentation",
                "location": "context/GIT_AUTOMATION_README.md",
                "content": "Documentation on when automatic commits occur and how to disable if needed"
              }
            ],
            "commit_schedule": {
              "description": "Automatic commits will occur at these workflow milestones",
              "00-setup": [
                "S-03-A06: After setup complete (initial commit)"
              ],
              "01-systems-engineering": [
                "SE-02: After each service architecture completed",
                "SE-06: After system graph generated and validated"
              ],
              "02-artifacts-visualization": [
                "AV-03: After human documentation generated",
                "AV-04: After visualizations created"
              ],
              "03-development": [
                "D-03: After each service foundation code completed",
                "D-03: After each service implementation completed and tests pass"
              ],
              "04-testing-operations": [
                "TO-02: After CI/CD pipeline configured",
                "TO-04: After successful deployment"
              ]
            }
          },
          "if_no": {
            "action": "Skip git setup, set git_automation_enabled: false in working_memory.json",
            "note": "User will manually manage git commits"
          },
          "llm_agent_instructions": [
            "ASK the user via AskUserQuestion tool if they want automatic git commits",
            "If YES: Execute git setup steps 1-8 in order",
            "Collect git remote URL and branch from user",
            "Create meaningful initial commit with workflow metadata",
            "Handle push failures gracefully (warn but continue)",
            "Document git configuration in working_memory.json",
            "If NO: Set git_automation_enabled: false and skip to next step"
          ],
          "success_criteria": [
            "User question asked and answered",
            "If yes: Git repo initialized/configured, initial commit made, working_memory.json updated",
            "If no: Git automation disabled in working_memory.json"
          ]
        }
      ],
      "tools_used": [
        "bootstrap_development_context.py",
        "generate_rag_embeddings.py (optional)"
      ],
      "templates_used": [
        "working_memory_template.json",
        "step_progress_tracker_template.json",
        "current_focus_template.md",
        "rag_context_config_template.json (optional)"
      ],
      "outputs": [
        "docs/SYSTEM_MISSION_STATEMENT.md",
        "docs/USER_SCENARIOS.md",
        "docs/SUCCESS_CRITERIA.md",
        "context/working_memory.json",
        "context/step_progress_tracker.json",
        "context/current_focus.md",
        "context/git_config.json (if git automation enabled)",
        ".gitignore (if git automation enabled)"
      ],
      "gates": [
        {
          "gate_id": "G-S-03",
          "name": "Foundational Documents Complete",
          "checks": [
            "All three foundational documents exist",
            "Documents contain meaningful content (not just templates)",
            "working_memory.json initialized with correct paths"
          ]
        }
      ],
      "next_step": "S-04-decision"
    },
    {
      "step_id": "S-04-decision",
      "name": "System-of-Systems Decision",
      "description": "Determine if this is a system-of-systems integration project",
      "phase": "initialization",
      "decision_type": "user_input",
      "question": "Is this a system-of-systems integration project (multiple independent systems that need to work together)?",
      "options": {
        "yes": {
          "description": "Multi-system integration required",
          "next_step": "S-04"
        },
        "no": {
          "description": "Single system or standard service decomposition",
          "next_step": "complete",
          "transition_to": "01-systems_engineering"
        }
      }
    },
    {
      "step_id": "S-04",
      "name": "System-of-Systems Decomposition (Optional)",
      "description": "Decompose high-level concept into multiple independent systems",
      "phase": "initialization",
      "optional": true,
      "step_file": "workflow_steps/setup/S-04-SystemOfSystems.json",
      "when_to_use": "Multi-system integration projects where systems have independent lifecycles",
      "actions": [
        {
          "action_id": "S-04-A01",
          "description": "Analyze system-of-systems requirements",
          "purpose": "Identify independent systems that need integration",
          "creates": "Initial system-of-systems breakdown"
        },
        {
          "action_id": "S-04-A02",
          "description": "Define system boundaries",
          "purpose": "Clarify which capabilities belong to which system",
          "output": "System boundary definitions"
        },
        {
          "action_id": "S-04-A03",
          "description": "Identify integration points",
          "purpose": "Understand how systems will interact",
          "tool": "identify_integration_points.py (may be used later)"
        },
        {
          "action_id": "S-04-A04",
          "description": "Create separate system directories",
          "purpose": "Each system gets its own directory structure",
          "pattern": "Create {system_root}/../{system_name}/ for each identified system"
        }
      ],
      "tools_used": [],
      "outputs": [
        "Multiple system directories (one per system)",
        "System-of-systems documentation in docs/",
        "Integration requirements documented"
      ],
      "gates": [],
      "next_step": "complete",
      "transition_to": "01-systems_engineering",
      "note": "Each identified system will go through workflows independently, then integrate"
    }
  ],
  "quality_gates": {},
  "next_workflow": "00b-framework_selection OR 01a-approach_detection",
  "next_workflow_note": "If user wants detailed framework analysis, go to 00b. If framework already selected or using default, go to 01a."
}