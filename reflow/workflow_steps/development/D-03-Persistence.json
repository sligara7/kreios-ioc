{
  "workflow_metadata": {
    "version": "0.1.0",
    "name": "Dev-03 Persistence & Migration Enablement",
    "based_on": "service_development_workflow.json D4",
    "description": "Align persistent storage with data models and define migration lifecycle."
  },
  "entry_conditions": {
    "from": "Dev-02",
    "artifacts": ["specs/machine/service_arch/<service>/data_models.json"]
  },
  "steps": [
    { "id": "D4.1", "description": "Generate schema migrations from data_models.json", "tool": "manual", "outputs": ["code/<service>/migrations/"] },
    { "id": "D4.2", "description": "Implement repository/data access adapters", "tool": "manual" },
    { "id": "D4.3", "description": "Introduce caching/TTL per infrastructure.json", "tool": "manual" },
    { "id": "D4.4", "description": "Add data validation/normalization pre-persistence", "tool": "manual" },
    { "id": "D4.5", "description": "Document rollback plan for each migration", "tool": "manual", "outputs": ["specs/human/service_docs/<service>/rollback_plan.md"] }
  ],
  "artifact_routing": {
    "code": "code/<service>/",
    "machine_specs": "specs/machine/service_arch/<service>/",
    "human_docs": "specs/human/service_docs/<service>/"
  },
  "iteration_paths": {
    "on_model_change": "../feature_update/FU-02-ArchReengineering.json",
    "on_spec_violation": "../architecture/Arch-05-ConsistencyAndSpecVerification.json"
  },
  "validation": {
    "exit_criteria": ["Migrations reproducible", "Repositories map to domain models", "Cache strategy realized"]
  },
  "handoff": {
    "produces": ["code/<service>/migrations/", "specs/human/service_docs/<service>/rollback_plan.md"],
    "next_workflow": "../development/Dev-04-IntegrationAndSecurity.json"
  }
}
