{
  "workflow_metadata": {
    "version": "1.0.0",
    "name": "BU-06 Validation & Verification",
    "description": "Validate bottom-up integration architecture is coherent, generate system graph, validate component deltas"
  },
  "entry_conditions": {
    "from": "BU-05-IntegrationArchitectureDesign",
    "artifacts": [
      "specs/machine/system_architecture.json",
      "specs/machine/systems/*/services/*/component_architecture.json",
      "specs/machine/interface_registry.json",
      "specs/machine/component_deltas/*.json"
    ]
  },
  "steps": [
    {
      "id": "BU-06.1",
      "name": "Validate Architecture Files",
      "description": "Run architecture validation for each tier",
      "tool": "{reflow_root}/tools/validate_architecture.py",
      "command": "python3 {reflow_root}/tools/validate_architecture.py {system_root} --validate-nested",
      "validation_checks": [
        "All required sections present",
        "Parent-child relationships valid",
        "Tier depth consistency",
        "Interface references valid",
        "Delta change links valid"
      ]
    },
    {
      "id": "BU-06.2",
      "name": "Create Index File",
      "description": "Create index.json referencing all architecture files (use symlinks for latest versions)",
      "tool": "manual",
      "template": "{reflow_root}/templates/index_template.json",
      "output_path": "{system_root}/specs/machine/index.json",
      "note": "Enhanced index supports nested architectures with tier hierarchy"
    },
    {
      "id": "BU-06.3",
      "name": "Generate System of Systems Graph",
      "description": "Generate multi-tier graph showing all components and their relationships",
      "tool": "{reflow_root}/tools/system_of_systems_graph_v2.py",
      "command": "python3 {reflow_root}/tools/system_of_systems_graph_v2.py {system_root}/specs/machine/index.json --detect-gaps --analyze-issues --nested-tiers",
      "graph_features": [
        "Multi-tier node representation",
        "Tier-crossing edge detection",
        "Integration gap visualization",
        "Adapter/mediator nodes",
        "Delta change annotations"
      ],
      "outputs": ["specs/machine/graphs/system_of_systems_graph.json"]
    },
    {
      "id": "BU-06.4",
      "name": "Validate Component Deltas",
      "description": "Validate all component deltas are feasible",
      "tool": "{reflow_root}/tools/validate_component_deltas.py",
      "command": "python3 {reflow_root}/tools/validate_component_deltas.py --all-deltas {system_root}/specs/machine/component_deltas/ --inventory {system_root}/specs/machine/component_inventory.json",
      "validation_checks": [
        "No conflicts with existing code",
        "Dependencies compatible",
        "Breaking changes flagged correctly",
        "Effort estimates reasonable"
      ]
    },
    {
      "id": "BU-06.5",
      "name": "Check for Circular Dependencies",
      "description": "Analyze graph for circular dependencies",
      "tool": "system_of_systems_graph_v2.py (includes cycle detection)",
      "expected_result": "No circular dependencies in integration architecture",
      "action_if_found": "Refactor architecture to break cycles (may require additional mediators)"
    },
    {
      "id": "BU-06.6",
      "name": "Verify Interface Consistency",
      "description": "Ensure all interfaces are defined on both producer and consumer sides",
      "tool": "manual",
      "checks": [
        "For each interface, both sides agree on protocol",
        "Data schemas match",
        "Authentication requirements consistent"
      ]
    },
    {
      "id": "BU-06.7",
      "name": "Generate Integration Validation Report",
      "description": "Create comprehensive validation report",
      "tool": "manual",
      "output_path": "{system_root}/docs/INTEGRATION_VALIDATION_REPORT.md",
      "includes": [
        "Architecture validation summary",
        "Graph analysis summary",
        "Component delta validation summary",
        "Integration readiness assessment",
        "Identified risks and mitigations",
        "Recommended next steps"
      ]
    }
  ],
  "validation": {
    "checks": [
      "All architecture files validate successfully",
      "System graph generated without errors",
      "No circular dependencies detected",
      "All component deltas validated",
      "Interface registry complete"
    ],
    "gates": [
      {
        "gate_id": "G-BU-06",
        "name": "Bottom-Up Integration Validation Gate",
        "checks": [
          "All architecture files pass validation",
          "System graph shows coherent integration",
          "No critical integration gaps remain unresolved",
          "Component deltas are feasible",
          "Integration readiness = high"
        ],
        "blocking": true
      }
    ]
  },
  "handoff": {
    "produces": [
      "specs/machine/index.json",
      "specs/machine/graphs/system_of_systems_graph.json",
      "docs/INTEGRATION_VALIDATION_REPORT.md"
    ],
    "next_workflow": "SE-02 (Service Architecture Specification) OR 03-development (if architecture complete)",
    "note": "Bottom-up integration workflow merges with standard workflow at SE-02. Architecture files are now created, can proceed to development or further refinement."
  },
  "llm_agent_guidance": {
    "critical_reminders": [
      "This is validation gate - MUST pass before proceeding to development",
      "system_of_systems_graph_v2.py MUST run successfully with --nested-tiers flag",
      "Circular dependencies are CRITICAL issues - require architectural refactoring",
      "If validation fails, return to BU-05 (architecture design) to fix issues",
      "Integration validation report should provide clear go/no-go decision"
    ],
    "success_criteria": {
      "architecture_validation": "Zero validation errors across all tiers",
      "graph_generation": "Graph generated successfully showing all components and relationships",
      "delta_validation": "All deltas feasible, no breaking changes except where planned",
      "interface_consistency": "All interfaces defined on both producer and consumer sides",
      "integration_readiness": "High (ready to proceed to development)"
    }
  }
}
