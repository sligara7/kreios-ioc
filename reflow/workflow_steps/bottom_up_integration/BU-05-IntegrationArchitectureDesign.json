{
  "workflow_metadata": {
    "version": "1.0.0",
    "name": "BU-05 Integration Architecture Design",
    "description": "Design multi-tier architecture showing how components integrate, create nested architecture files, design adapters/mediators"
  },
  "entry_conditions": {
    "from": "BU-04-ComponentDeltaAnalysis",
    "artifacts": [
      "specs/machine/component_inventory.json",
      "specs/machine/integration_gaps.json",
      "specs/machine/component_deltas/*.json"
    ]
  },
  "steps": [
    {
      "id": "BU-05.1",
      "name": "Create Tier Hierarchy",
      "description": "Organize components into tier hierarchy (tier_0 → tier_1 → tier_2 → tier_3 → tier_4)",
      "tool": "manual",
      "outputs": ["Tier hierarchy diagram showing parent-child relationships"]
    },
    {
      "id": "BU-05.2",
      "name": "Design Adapter Components",
      "description": "For integration gaps requiring adapters, design adapter components",
      "tool": "manual",
      "adapter_types": [
        "Protocol adapters (REST to gRPC, sync to async)",
        "Data format adapters (JSON to XML, schema transformation)",
        "API version adapters (v1 to v2 translation)"
      ],
      "outputs": ["Adapter component specifications"]
    },
    {
      "id": "BU-05.3",
      "name": "Design Mediator Components",
      "description": "For complex interactions requiring coordination, design mediator components",
      "tool": "manual",
      "outputs": ["Mediator component specifications"]
    },
    {
      "id": "BU-05.4",
      "name": "Create Architecture Files (Nested)",
      "description": "Create component_architecture.json for each tier using nested template",
      "tool": "manual",
      "template": "{reflow_root}/templates/component_architecture_nested_template.json",
      "directory_structure": {
        "tier_0": "{system_root}/specs/machine/system_architecture.json",
        "tier_1": "{system_root}/specs/machine/systems/{system_id}/system_architecture.json",
        "tier_2": "{system_root}/specs/machine/systems/{system_id}/services/{service_id}/service_architecture.json",
        "tier_3": "{system_root}/specs/machine/systems/{system_id}/services/{service_id}/components/{component_id}/component_architecture.json",
        "tier_4": "{system_root}/specs/machine/systems/{system_id}/services/{service_id}/components/{component_id}/modules/{module_id}/module_architecture.json"
      },
      "required_fields": [
        "parent_component (if tier_depth > 0)",
        "child_components (if not leaf)",
        "tier_depth",
        "integration_role (existing_component | new_adapter | new_mediator)",
        "delta_changes_applied (if modified)"
      ]
    },
    {
      "id": "BU-05.5",
      "name": "Define Tier-Crossing Interfaces",
      "description": "For interfaces that cross tiers (e.g., tier_3 calling tier_2), define integration mechanisms",
      "tool": "manual",
      "outputs": ["Tier-crossing interfaces with mechanisms (REST, in-process, message queue)"]
    },
    {
      "id": "BU-05.6",
      "name": "Create Interface Registry",
      "description": "Catalog all interfaces in interface_registry.json",
      "tool": "manual",
      "template": "{reflow_root}/templates/interface_registry_enhanced_template.json",
      "output_path": "{system_root}/specs/machine/interface_registry.json"
    },
    {
      "id": "BU-05.7",
      "name": "Link Deltas to Architecture",
      "description": "Update each architecture file's integration_context.delta_changes_applied to reference component deltas",
      "tool": "manual",
      "outputs": ["Architecture files linked to delta specifications"]
    }
  ],
  "validation": {
    "checks": [
      "All components have architecture files",
      "Parent-child relationships are consistent",
      "Tier depth matches hierarchical_tier",
      "All adapters/mediators have architecture files",
      "Delta changes are linked to architecture files"
    ]
  },
  "handoff": {
    "produces": [
      "specs/machine/system_architecture.json (tier 0)",
      "specs/machine/systems/*/system_architecture.json (tier 1)",
      "specs/machine/systems/*/services/*/service_architecture.json (tier 2)",
      "specs/machine/systems/*/services/*/components/*/component_architecture.json (tier 3)",
      "specs/machine/interface_registry.json"
    ],
    "next_workflow": "BU-06-ValidationVerification.json"
  }
}
