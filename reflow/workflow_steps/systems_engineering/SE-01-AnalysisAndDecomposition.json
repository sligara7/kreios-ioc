{
  "workflow_metadata": {
    "version": "0.1.1",
    "name": "Arch-02 System Analysis and Decomposition",
    "based_on": "architecture_workflow.json steps 1â€“2",
    "description": "Analyze the system, classify hierarchy, decompose services, and deduce interfaces with explicit artifact routing and iteration."
  },
  "entry_conditions": {
    "from": "Arch-01",
    "artifacts": [
      "context/process_log.md",
      "context/working_memory.json",
      "context/step_progress_tracker.json",
      "context/current_focus.md"
    ]
  },
  "steps": [
    {
      "id": "S1.1",
      "name": "Hierarchy Classification",
      "description": "Determine Level 0 type and decomposition strategy (UAF-based)",
      "tool": "manual"
    },
    {
      "id": "S1.2",
      "name": "Component & External Identification",
      "description": "Enumerate services/components and external systems",
      "tool": "manual"
    },
    {
      "id": "S2.1",
      "name": "Best Practices Retrieval (RAG)",
      "description": "Synthesize architecture best practices",
      "tool": "rag",
      "output": "specs/human/reports/best_practices_summary.md"
    },
    {
      "id": "S2.2",
      "name": "Two-Level Rule Decomposition",
      "description": "Decompose 2 levels minimum; escalate to L3 when triggers met",
      "tool": "manual"
    },
    {
      "id": "S2.3",
      "name": "Create service_architecture.json (per component)",
      "tool": "manual",
      "template": "/home/ajs7/project/saa/templates/service_architecture_template.json",
      "directory_structure": "systems/<system_name>/specs/machine/service_arch/<service_name>/service_architecture.json"
    },
    {
      "id": "S2.4",
      "name": "Build System Graph",
      "tool": "/home/ajs7/project/saa/tools/system_of_systems_graph.py",
      "command": "python3 /home/ajs7/project/saa/tools/system_of_systems_graph.py systems/<system_name> --format json --output systems/<system_name>/specs/machine/graphs/system_of_systems_graph.json",
      "output": "specs/machine/graphs/system_of_systems_graph.json"
    },
    {
      "id": "S2.5",
      "name": "Infer & Update Interfaces",
      "tool": "manual",
      "validation_per_batch": true
    },
    {
      "id": "S2.6",
      "name": "Create/Update index.json",
      "tool": "manual",
      "template": "/home/ajs7/project/saa/templates/index_template.json",
      "path": "systems/<system_name>/specs/machine/index.json"
    },
    {
      "id": "S2.7",
      "name": "Generate ICDs",
      "tool": "/home/ajs7/project/saa/tools/generate_interface_contracts.py",
      "command": "python3 /home/ajs7/project/saa/tools/generate_interface_contracts.py /home/ajs7/project/saa/systems/<system_name>/",
      "output": "specs/machine/interfaces/*.json"
    }
  ],
  "validation": {
    "tool": "/home/ajs7/project/saa/tools/validate_architecture.py",
    "check": "All services have service_architecture.json, index.json is complete, ICDs generated"
  },
  "artifact_routing": {
    "best_practices": "specs/human/reports/best_practices_summary.md",
    "service_architecture_per_service": "specs/machine/service_arch/<service>/service_architecture.json",
    "index_json": "specs/machine/index.json",
    "icds": "specs/machine/interfaces/",
    "graph": "specs/machine/graphs/system_of_systems_graph.json"
  },
  "iteration_paths": {
    "on_missing_components": "self",
    "on_interface_inference_issue": "self",
    "on_schema_violation": "../architecture/Arch-03-ConstraintsAndTemplateValidation.json"
  },
  "handoff": {
    "produces": [
      "specs/human/reports/best_practices_summary.md",
      "specs/machine/service_arch/<service>/service_architecture.json",
      "specs/machine/index.json",
      "specs/machine/interfaces/*",
      "specs/machine/graphs/system_of_systems_graph.json"
    ],
    "next_workflow": "../architecture/Arch-03-ConstraintsAndTemplateValidation.json"
  }
}
