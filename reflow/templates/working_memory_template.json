{
  "template_version": "2.0",
  "template_description": "Template for working_memory.json - context tracking with context management v3.0",
  "template_notes": "Version 2.0 adds comprehensive context management fields for preventing context drift and token exhaustion",
  "system_name": "REPLACE_WITH_SYSTEM_NAME",
  "current_workflow": "CURRENT_WORKFLOW_ID (e.g., 01-systems_engineering)",
  "current_step": "CURRENT_STEP_ID",
  "current_substep": "CURRENT_SUBSTEP_ID",
  "paths": {
    "reflow_root": "/absolute/path/to/reflow",
    "system_root": "/absolute/path/to/system",
    "tools_path": "/absolute/path/to/reflow/tools",
    "templates_path": "/absolute/path/to/reflow/templates",
    "workflow_steps_path": "/absolute/path/to/reflow/workflow_steps",
    "definitions_path": "/absolute/path/to/reflow/definitions",
    "note": "CRITICAL: These paths MUST be read and used for ALL tool/template/workflow references. Set during Setup workflow (00a-basic_setup). LLM agents: ALWAYS extract these paths from working_memory.json before invoking tools."
  },
  "framework_configuration": {
    "framework_id": "FRAMEWORK_ID (uaf|decision_flow|systems_biology|social_network|ecological|complex_adaptive|custom)",
    "framework_name": "FRAMEWORK_DISPLAY_NAME",
    "component_term": "TERM_FOR_NODES (service|workflow_step|component|agent|species|adaptive_agent)",
    "connection_term": "TERM_FOR_EDGES (interface|transition|interaction|relationship|ecological_interaction)",
    "architecture_file_type": "FILE_TYPE (service_architecture.json|workflow_step_architecture.json|component_architecture.json|etc)",
    "selected_framework_rationale": "DETAILED_RATIONALE_WHY_THIS_FRAMEWORK_WAS_CHOSEN (must explain semantic match and what insights it reveals)",
    "user_confirmed": false,
    "confirmation_timestamp": "YYYY-MM-DD HH:MM:SS or null",
    "note": "Set during Setup workflow step S-01A (Framework Selection) - REQUIRES EXPLICIT USER CONFIRMATION per LESSON-01"
  },
  "framework_analysis": {
    "system_characteristics": {
      "primary_entities": "WHAT_ARE_THE_NODES (services? states? agents? species?)",
      "connections": "WHAT_ARE_THE_EDGES (APIs? transitions? relationships? interactions?)",
      "has_decision_points": false,
      "has_conditional_routing": false,
      "cycles_expected": "YES|NO - Are cycles feedback loops (expected) or circular dependencies (errors)?",
      "needs_flow_analysis": false,
      "domain": "SYSTEM_DOMAIN (engineered, biological, social, ecological, emergent)"
    },
    "frameworks_evaluated": [],
    "recommended_analyses": [],
    "alternatives_rejected": {},
    "analysis_timestamp": "YYYY-MM-DD HH:MM:SS",
    "note": "Populated during S-01A framework selection analysis - documents WHICH frameworks were considered and WHY others were rejected"
  },
  "analysis_configuration": {
    "selected_analyses": {
      "centrality": false,
      "paths": false,
      "connectivity": false,
      "clustering": false,
      "properties": false,
      "community": false,
      "cycles": false,
      "scc": false,
      "dag": false,
      "flow": false
    },
    "analysis_rationale": "WHY_THESE_ANALYSES_WERE_SELECTED (based on framework recommendations)",
    "edge_weights_included": false,
    "edge_weight_semantic": "WHAT_WEIGHTS_REPRESENT (e.g., request_rate, reaction_rate, interaction_frequency, energy_flow)",
    "knowledge_gap_detection_enabled": false,
    "architectural_issues_detection_enabled": false,
    "note": "Set during Systems Engineering workflow step SE-06 (Graph Generation)"
  },
  "context_management": {
    "operations_since_refresh": 0,
    "refresh_threshold": 5,
    "last_refresh_timestamp": "YYYY-MM-DD HH:MM:SS",
    "total_refreshes_this_workflow": 0,
    "refresh_triggers": {
      "threshold_triggered": 0,
      "degradation_triggered": 0,
      "manual_triggered": 0,
      "context_flow_triggered": 0
    },
    "degradation_signals_detected": [],
    "last_degradation_signal": null,
    "context_health": "HEALTHY|DEGRADING|CRITICAL",
    "cumulative_context_tokens": 0,
    "llm_capabilities": {
      "model_name": "DETECTED_MODEL_NAME (e.g., Claude Sonnet 4.5, GPT-4 Turbo)",
      "context_window_tokens": 0,
      "recommended_threshold": 0,
      "safety_margin_percent": 80,
      "refresh_strategy": "conservative|moderate|aggressive",
      "auto_detected": false,
      "detection_timestamp": "YYYY-MM-DD HH:MM:SS",
      "detection_method": "interactive|manual",
      "note": "v3.9.1 - Auto-detect LLM context window at workflow start/resume. Run: python3 {paths.tools_path}/detect_llm_capabilities.py --interactive --update-working-memory {paths.system_root}"
    },
    "context_flow_analysis": {
      "enabled": false,
      "current_step": "CURRENT_STEP_ID",
      "next_step": "NEXT_STEP_ID",
      "predicted_cumulative": 0,
      "threshold": 40000,
      "refresh_recommended": false,
      "refresh_reason": null,
      "recommended_refresh_before": null,
      "note": "v3.9.0 - Predictive context management via flow analysis. v3.9.1: Threshold auto-set from llm_capabilities"
    },
    "notes": [
      "v3.9.1: FIRST ACTION when starting/resuming workflow: Detect LLM capabilities (see llm_capabilities.note)",
      "Increment operations_since_refresh after each real operation (see context_management_template.json)",
      "When operations_since_refresh >= 5, execute context refresh sequence",
      "When degradation signal detected, execute refresh immediately regardless of counter",
      "v3.9.0: When context_flow_analysis.refresh_recommended is true, execute refresh before predicted bottleneck",
      "After refresh, reset operations_since_refresh to 0 and update last_refresh_timestamp AND re-detect LLM capabilities"
    ]
  },
  "hierarchy_level": "LEVEL_0_CLASSIFICATION",
  "component_list": [],
  "external_systems": [],
  "global_constraints": {},
  "progress_summary": {
    "completed_steps": [],
    "current_focus": "DESCRIPTION_OF_CURRENT_TASK",
    "next_action": "DESCRIPTION_OF_NEXT_ACTION",
    "validation_status": "PENDING|PASSED|FAILED"
  },
  "artifact_status": {
    "service_architectures_created": 0,
    "interfaces_deduced": 0,
    "icds_generated": false,
    "index_json_updated": false,
    "interface_registry_created": false,
    "validation_passed": false
  },
  "workflow_metrics": {
    "workflow_start_time": "YYYY-MM-DD HH:MM:SS",
    "current_step_start_time": "YYYY-MM-DD HH:MM:SS",
    "total_operations": 0,
    "total_tool_invocations": 0,
    "total_validations": 0,
    "validation_failures": 0,
    "rework_cycles": 0,
    "note": "These metrics feed into self-improvement - track diligently"
  },
  "context_metadata": {
    "working_directory": "systems/<system_name>",
    "last_validation_timestamp": null,
    "pwd_verified_timestamp": null,
    "pwd_verification_count": 0,
    "note": "pwd should be verified before EVERY significant operation"
  }
}