{
  "template_version": "1.0",
  "template_description": "Security architecture requirements for IT systems with human users. REQUIRED for UAF systems with human-facing interfaces.",
  "applicability": {
    "framework": "uaf",
    "system_type": "IT systems with human users",
    "mandatory_when": "Any service with human user interaction or external API access",
    "optional_when": "Internal-only services with no human users"
  },
  "security_posture": {
    "classification": "REQUIRED: public_facing | internal_only | hybrid",
    "user_types": [
      "REQUIRED: List all user types (e.g., end_users, administrators, api_consumers, service_accounts)"
    ],
    "data_sensitivity": "REQUIRED: public | internal | confidential | restricted",
    "threat_model": "REQUIRED: Describe primary security threats and attack vectors",
    "compliance_requirements": [
      "OPTIONAL: GDPR, HIPAA, PCI-DSS, SOC2, etc."
    ]
  },
  "authentication": {
    "strategy": "REQUIRED: jwt | oauth2 | saml | api_key | mutual_tls | multi_factor",
    "identity_provider": "REQUIRED: self_hosted | auth0 | okta | cognito | firebase | keycloak | custom",
    "session_management": {
      "session_duration": "REQUIRED: Duration in seconds (e.g., 3600 for 1 hour)",
      "refresh_token_enabled": false,
      "session_storage": "REQUIRED: jwt | redis | database | in_memory",
      "concurrent_sessions": "REQUIRED: single | multiple | limited"
    },
    "password_policy": {
      "minimum_length": 12,
      "require_uppercase": true,
      "require_lowercase": true,
      "require_numbers": true,
      "require_special_chars": true,
      "password_history": 5,
      "expiration_days": 90
    },
    "multi_factor_authentication": {
      "required": false,
      "methods": ["totp", "sms", "email", "hardware_token"],
      "required_for_roles": ["administrator", "privileged_user"]
    },
    "implementation_notes": "Describe authentication flow, token format, and validation strategy"
  },
  "authorization": {
    "model": "REQUIRED: rbac | abac | acl | custom",
    "rbac_roles": [
      {
        "role_name": "EXAMPLE: administrator",
        "permissions": ["read:all", "write:all", "delete:all", "manage:users"],
        "description": "Full system access"
      },
      {
        "role_name": "EXAMPLE: end_user",
        "permissions": ["read:own", "write:own"],
        "description": "Access to own resources only"
      }
    ],
    "resource_ownership": "REQUIRED: user_owned | shared | public | hierarchical",
    "permission_granularity": "REQUIRED: service_level | resource_level | field_level",
    "enforcement_points": [
      "REQUIRED: api_gateway | service_layer | database_layer"
    ],
    "implementation_notes": "Describe authorization checks, permission inheritance, and role assignment"
  },
  "api_gateway": {
    "required": true,
    "gateway_type": "REQUIRED: nginx | kong | traefik | api_gateway | custom",
    "responsibilities": [
      "REQUIRED: List gateway responsibilities (e.g., authentication, rate_limiting, routing, ssl_termination, request_validation)"
    ],
    "routing": {
      "strategy": "REQUIRED: path_based | host_based | header_based",
      "example_routes": [
        {
          "path": "/api/v1/users",
          "backend_service": "user_service",
          "authentication_required": true,
          "rate_limit": "100 req/min per user"
        }
      ]
    },
    "ssl_tls": {
      "enabled": true,
      "tls_version": "REQUIRED: TLS 1.2+ (TLS 1.3 recommended)",
      "certificate_management": "REQUIRED: letsencrypt | acm | self_signed | commercial_ca",
      "hsts_enabled": true,
      "cipher_suites": "REQUIRED: modern | intermediate | old (Mozilla SSL Config Generator)"
    },
    "cors_policy": {
      "enabled": true,
      "allowed_origins": [
        "REQUIRED: https://app.example.com or * (NOT RECOMMENDED for production)"
      ],
      "allowed_methods": ["GET", "POST", "PUT", "DELETE", "PATCH"],
      "allowed_headers": ["Authorization", "Content-Type"],
      "expose_headers": ["X-Request-ID"],
      "max_age": 3600,
      "credentials_allowed": true
    },
    "implementation_notes": "Describe gateway deployment, configuration management, and failover strategy"
  },
  "rate_limiting": {
    "enabled": true,
    "strategy": "REQUIRED: token_bucket | fixed_window | sliding_window | leaky_bucket",
    "enforcement_level": "REQUIRED: user | ip_address | api_key | service",
    "default_limits": {
      "requests_per_second": 10,
      "requests_per_minute": 100,
      "requests_per_hour": 1000,
      "burst_allowance": 20
    },
    "per_endpoint_limits": [
      {
        "endpoint": "/api/v1/login",
        "limit": "5 requests per 15 minutes per IP",
        "rationale": "Prevent brute force attacks"
      },
      {
        "endpoint": "/api/v1/search",
        "limit": "50 requests per minute per user",
        "rationale": "Expensive operation, prevent abuse"
      }
    ],
    "response_behavior": {
      "status_code": 429,
      "retry_after_header": true,
      "error_message": "Rate limit exceeded. Please try again later."
    },
    "implementation_notes": "Describe rate limit storage (Redis, in-memory), bypass rules for trusted IPs"
  },
  "input_validation": {
    "strategy": "REQUIRED: whitelist | schema_validation | sanitization | all",
    "validation_library": "REQUIRED: joi | yup | pydantic | json_schema | custom",
    "validation_points": [
      "REQUIRED: api_gateway | service_layer | database_layer"
    ],
    "common_validations": {
      "email": "RFC 5322 compliant",
      "phone": "E.164 format",
      "urls": "HTTP/HTTPS only, whitelist domains",
      "user_input": "HTML entity encoding, XSS prevention",
      "file_uploads": "File type validation, size limits, virus scanning"
    },
    "sql_injection_prevention": "REQUIRED: parameterized_queries | orm | prepared_statements",
    "xss_prevention": "REQUIRED: output_encoding | csp_headers | input_sanitization",
    "implementation_notes": "Describe validation rules, error responses, and logging strategy"
  },
  "encryption": {
    "in_transit": {
      "enabled": true,
      "protocol": "REQUIRED: TLS 1.2+ (TLS 1.3 recommended)",
      "internal_services": "REQUIRED: tls | mtls | plaintext (NOT RECOMMENDED)",
      "certificate_rotation": "REQUIRED: Describe cert renewal strategy and automation"
    },
    "at_rest": {
      "enabled": true,
      "sensitive_fields": [
        "REQUIRED: List fields requiring encryption (e.g., passwords, ssn, credit_cards, api_keys)"
      ],
      "encryption_algorithm": "REQUIRED: AES-256-GCM | ChaCha20-Poly1305",
      "key_management": "REQUIRED: aws_kms | azure_key_vault | hashicorp_vault | envelope_encryption | custom",
      "key_rotation_frequency": "REQUIRED: Duration in days (e.g., 90, 365)"
    },
    "implementation_notes": "Describe encryption libraries, key derivation, and secure key storage"
  },
  "audit_logging": {
    "enabled": true,
    "log_retention": "REQUIRED: Duration in days (e.g., 90, 365, 2555 for 7 years)",
    "events_to_log": [
      "REQUIRED: authentication_attempts | authorization_failures | data_access | data_modification | admin_actions | security_events"
    ],
    "log_fields": {
      "required": [
        "timestamp",
        "user_id",
        "action",
        "resource",
        "ip_address",
        "user_agent",
        "result (success/failure)"
      ],
      "optional": [
        "request_id",
        "session_id",
        "geolocation"
      ]
    },
    "log_storage": {
      "backend": "REQUIRED: elasticsearch | cloudwatch | splunk | file_system | database",
      "encryption_enabled": true,
      "tamper_protection": "REQUIRED: write_once | digital_signatures | blockchain"
    },
    "alerting": {
      "enabled": true,
      "alert_conditions": [
        "EXAMPLE: Failed login attempts > 5 in 15 minutes",
        "EXAMPLE: Privilege escalation attempts",
        "EXAMPLE: Unusual data access patterns"
      ],
      "notification_channels": ["email", "slack", "pagerduty", "sms"]
    },
    "implementation_notes": "Describe log aggregation, analysis tools, and SIEM integration"
  },
  "security_headers": {
    "enabled": true,
    "headers": {
      "Content-Security-Policy": "REQUIRED: Define CSP policy (e.g., default-src 'self'; script-src 'self' 'unsafe-inline')",
      "X-Content-Type-Options": "nosniff",
      "X-Frame-Options": "DENY",
      "X-XSS-Protection": "1; mode=block",
      "Strict-Transport-Security": "max-age=31536000; includeSubDomains; preload",
      "Referrer-Policy": "strict-origin-when-cross-origin",
      "Permissions-Policy": "OPTIONAL: Define feature policy (e.g., geolocation=(), camera=())"
    },
    "implementation_notes": "Configure headers at API gateway or web server level"
  },
  "vulnerability_management": {
    "dependency_scanning": {
      "enabled": true,
      "tools": ["REQUIRED: snyk | dependabot | renovate | owasp_dependency_check"],
      "scan_frequency": "REQUIRED: on_commit | daily | weekly",
      "auto_remediation": false
    },
    "static_analysis": {
      "enabled": true,
      "tools": ["REQUIRED: sonarqube | semgrep | bandit | eslint"],
      "scan_frequency": "REQUIRED: on_commit | daily | weekly"
    },
    "penetration_testing": {
      "frequency": "OPTIONAL: annually | quarterly | after_major_releases",
      "scope": "OPTIONAL: Define testing scope"
    },
    "implementation_notes": "Describe CI/CD integration, vulnerability reporting, and remediation SLAs"
  },
  "secrets_management": {
    "strategy": "REQUIRED: environment_variables | secrets_manager | vault | encrypted_config",
    "secrets_storage": "REQUIRED: aws_secrets_manager | azure_key_vault | hashicorp_vault | kubernetes_secrets | doppler",
    "secrets_rotation": {
      "enabled": true,
      "rotation_frequency": "REQUIRED: Duration in days (e.g., 30, 90)",
      "automated": true
    },
    "secrets_types": [
      "EXAMPLE: database_credentials",
      "EXAMPLE: api_keys",
      "EXAMPLE: encryption_keys",
      "EXAMPLE: third_party_tokens"
    ],
    "implementation_notes": "Describe secret injection into services, rotation procedures, and access controls"
  },
  "incident_response": {
    "plan_exists": false,
    "security_contacts": [
      "REQUIRED: List security team contacts (email, phone, on-call rotation)"
    ],
    "breach_notification": {
      "timeline": "REQUIRED: Duration to notify users (e.g., 72 hours per GDPR)",
      "notification_channels": ["email", "in_app", "website_banner"],
      "legal_requirements": "OPTIONAL: Describe regulatory notification requirements"
    },
    "incident_playbooks": [
      {
        "incident_type": "EXAMPLE: data_breach",
        "playbook_url": "OPTIONAL: Link to incident response playbook"
      }
    ],
    "implementation_notes": "Describe incident detection, escalation, and recovery procedures"
  },
  "security_testing": {
    "unit_tests": {
      "authentication_tests": true,
      "authorization_tests": true,
      "input_validation_tests": true
    },
    "integration_tests": {
      "end_to_end_security_flows": true,
      "boundary_tests": true
    },
    "security_regression_tests": {
      "enabled": true,
      "frequency": "REQUIRED: on_commit | daily | weekly"
    },
    "implementation_notes": "Describe test coverage, test data management, and CI/CD integration"
  },
  "INSTRUCTIONS": {
    "when_to_use": "Use this template for ANY UAF system with human users or external API access",
    "required_sections": [
      "security_posture",
      "authentication",
      "authorization",
      "api_gateway (if public-facing)",
      "rate_limiting",
      "input_validation",
      "encryption",
      "audit_logging"
    ],
    "optional_sections": [
      "security_headers (highly recommended)",
      "vulnerability_management (recommended)",
      "secrets_management (recommended)",
      "incident_response (recommended for production systems)",
      "security_testing (recommended)"
    ],
    "integration_with_architecture": "Create security_architecture.json in specs/machine/ directory alongside service architectures",
    "validation_requirement": "Security architecture must be reviewed and approved before proceeding to implementation",
    "framework_conditional": "Only required for UAF framework with deployment_characteristics.port_management_applicable == true"
  }
}
