{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/sligara7/reflow/schemas/working_memory.json",
  "title": "Reflow Working Memory",
  "description": "Schema for working_memory.json files that track workflow state and context",
  "type": "object",
  "required": ["system_name", "current_workflow", "current_step", "path_configuration"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Reference to this JSON schema file"
    },
    "template_version": {
      "type": "string",
      "description": "Version of the working memory template"
    },
    "system_name": {
      "type": "string",
      "description": "Name of the system being developed",
      "minLength": 1
    },
    "current_workflow": {
      "type": "string",
      "description": "Current workflow being executed",
      "enum": ["00-setup", "01-systems_engineering", "02-artifacts_visualization", "03-development", "04-testing_operations", "feature_update"]
    },
    "current_step": {
      "type": "string",
      "description": "Current step ID within the workflow",
      "pattern": "^(S|SE|AV|D|TO|FU)-[0-9]+"
    },
    "current_substep": {
      "type": "string",
      "description": "Current substep ID (optional)"
    },
    "path_configuration": {
      "type": "object",
      "required": ["reflow_root", "system_root", "tools_path", "templates_path"],
      "properties": {
        "reflow_root": {
          "type": "string",
          "description": "Absolute path to Reflow installation directory",
          "minLength": 1
        },
        "system_root": {
          "type": "string",
          "description": "Absolute path to system being developed",
          "minLength": 1
        },
        "tools_path": {
          "type": "string",
          "description": "Absolute path to Reflow tools directory",
          "minLength": 1
        },
        "templates_path": {
          "type": "string",
          "description": "Absolute path to Reflow templates directory",
          "minLength": 1
        },
        "workflow_steps_path": {
          "type": "string",
          "description": "Absolute path to Reflow workflow steps directory"
        },
        "definitions_path": {
          "type": "string",
          "description": "Absolute path to Reflow definitions directory"
        }
      }
    },
    "framework_configuration": {
      "type": "object",
      "description": "Architectural framework configuration",
      "properties": {
        "framework_id": {
          "type": "string",
          "enum": ["uaf", "systems_biology", "social_network", "ecological", "complex_adaptive", "custom"]
        },
        "framework_name": {
          "type": "string"
        },
        "component_term": {
          "type": "string",
          "description": "Term for components in this framework (e.g., 'service', 'gene', 'agent')"
        },
        "connection_term": {
          "type": "string",
          "description": "Term for connections in this framework (e.g., 'interface', 'interaction', 'relationship')"
        }
      }
    },
    "context_management": {
      "type": "object",
      "description": "Context management tracking",
      "properties": {
        "operations_since_refresh": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of operations since last context refresh"
        },
        "refresh_threshold": {
          "type": "integer",
          "minimum": 1,
          "default": 5,
          "description": "Threshold for triggering context refresh"
        },
        "context_health": {
          "type": "string",
          "enum": ["HEALTHY", "DEGRADING", "CRITICAL"],
          "description": "Current context health status"
        }
      }
    },
    "component_list": {
      "type": "array",
      "description": "List of components in the system",
      "items": {
        "type": "string"
      }
    },
    "progress_summary": {
      "type": "object",
      "description": "Summary of workflow progress",
      "properties": {
        "completed_steps": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "current_focus": {
          "type": "string"
        },
        "next_action": {
          "type": "string"
        }
      }
    }
  },
  "additionalProperties": true,
  "errorMessage": {
    "required": {
      "system_name": "Missing required field 'system_name'",
      "current_workflow": "Missing required field 'current_workflow'",
      "current_step": "Missing required field 'current_step'",
      "path_configuration": "Missing required field 'path_configuration' with reflow_root and system_root"
    }
  }
}
