{
  "workflow_metadata": {
    "workflow_id": "02-artifacts_visualization",
    "name": "Artifacts & Visualization Workflow",
    "version": "1.0.0",
    "description": "Generate human-readable documentation, Mermaid diagrams, ICDs, and visualizations",
    "created_from": "decision_flow.json v2.5.0 - extracted from Arch-06 (human-readable artifacts)",
    "last_updated": "2025-10-24",
    "purpose": "Create deliverables for human consumption and development handoff",
    "conditional": true,
    "conditional_description": "User can choose architecture-only (minimal artifacts) or full development (all artifacts)"
  },
  "prerequisites": {
    "required_workflows": ["00-setup", "01-systems_engineering"],
    "required_files": [
      "specs/machine/index.json",
      "specs/machine/service_arch/{service}/service_architecture_v*.json (all services)",
      "specs/machine/interface_registry.json",
      "specs/machine/graphs/system_of_systems_graph.json"
    ]
  },
  "entry_points": {
    "from_systems_engineering": {
      "id": "from_systems_engineering",
      "description": "Standard entry after completing systems engineering workflow",
      "first_step": "AV-00-decision"
    },
    "architecture_only_completion": {
      "id": "architecture_only_completion",
      "description": "User wants architecture only, no development",
      "first_step": "AV-00-decision",
      "preset_choice": "architecture_only"
    }
  },
  "context_management": {
    "description": "Prevent context drift and token exhaustion during workflow execution",
    "template_reference": "See templates/context_management_template.json for complete details",
    "rag_enhanced_mode": {
      "description": "RECOMMENDED - Use RAG for automatic context injection and degradation detection",
      "setup": "Initialize in S-03-A05 (Setup workflow)",
      "benefits": "Automatic context refresh, degradation detection, token-efficient retrieval",
      "usage": "python3 {reflow_root}/tools/rag_agent_wrapper.py {system_root} wrap --query 'your query' --strategy on_step_start",
      "fallback": "If RAG not set up, use manual operations counter and refresh sequence below"
    },
    "operations_counter": {
      "threshold": 5,
      "tracking_location": "context/working_memory.json (operations_since_refresh field)",
      "rule": "Increment after each real operation (file creation, tool execution, artifact generation)",
      "refresh_trigger": "When >= 5, execute refresh sequence immediately"
    },
    "degradation_signals_watch_for": [
      "Asking about system name (it's in working_memory.json)",
      "Forgetting current step",
      "Working in wrong directory (pwd != system_root)",
      "Creating diagrams for wrong system",
      "Generating documentation that doesn't match architecture"
    ],
    "refresh_sequence_summary": [
      "1. PAUSE - Stop all operations",
      "2. VERIFY PWD - Confirm in correct directory",
      "3. SAVE STATE - Update working_memory.json and step_progress_tracker.json",
      "4. RELOAD - Read workflow file, service_architecture files, templates",
      "5. READ - current_focus.md and step_progress_tracker.json",
      "6. CONFIRM - State system name, workflow, step, next action",
      "7. RESET - Set operations_since_refresh = 0",
      "8. RESUME - Continue with confirmed action"
    ],
    "pre_operation_checklist": [
      "Verify pwd equals system_root",
      "Read current_focus.md",
      "Read step_progress_tracker.json",
      "Verify action matches current step",
      "Check operations_since_refresh <= 4"
    ]
  },
  "self_improvement": {
    "description": "Continuous workflow improvement through observation and metrics",
    "template_reference": "See templates/self_improvement_template.json for complete details",
    "during_execution": {
      "observe": ["Time efficiency", "Documentation clarity", "Diagram generation time", "ICD completeness", "Tool effectiveness"],
      "document": "Log observations to context/process_log.md with timestamps",
      "track_metrics": "Update context/workflow_metrics.json after each step"
    },
    "after_completion": {
      "retrospective_file": "context/workflow_retrospective_02-artifacts_visualization_{date}.md",
      "key_questions": [
        "What worked well?",
        "Were generated diagrams accurate and helpful?",
        "What documentation was missing?",
        "What took longer than expected?",
        "How could diagram generation be improved?"
      ],
      "improvement_submission": "Add entries to WORKFLOW_IMPROVEMENTS_BACKLOG.md"
    }
  },
  "workflow_steps": [
    {
      "step_id": "AV-00-decision",
      "name": "Development Intent Decision",
      "description": "Determine if user plans to develop/implement the system",
      "phase": "decision",
      "decision_type": "user_input",
      "question": "Do you plan to develop/implement this system, or is this architecture-only for handoff?",
      "options": {
        "develop": {
          "description": "Yes, I plan to develop this system (generate all development artifacts)",
          "next_step": "AV-01"
        },
        "architecture_only": {
          "description": "Architecture only - create minimal handoff package",
          "next_step": "AV-04",
          "skip_steps": ["AV-01", "AV-02", "AV-03"]
        }
      }
    },
    {
      "step_id": "AV-01",
      "name": "Interface Contract Documents (ICDs)",
      "description": "Generate detailed Interface Contract Documents for all interfaces",
      "phase": "artifacts",
      "step_file": "workflow_steps/artifacts_visualization/AV-01-InterfaceContracts.json",
      "maps_from": "Arch-06: Implementation Artifacts (ICD generation)",
      "when_to_use": "Only if user plans to develop the system",
      "actions": [
        {
          "action_id": "AV-01-A01",
          "description": "Generate ICDs for all interfaces",
          "tool": "generate_interface_contracts.py",
          "command_pattern": "python3 {reflow_root}/tools/generate_interface_contracts.py {system_root}",
          "purpose": "Create detailed interface specifications for developers",
          "inputs": ["specs/machine/interface_registry.json"],
          "outputs": ["specs/machine/interfaces/{interface_name}_icd.json (per interface)"]
        },
        {
          "action_id": "AV-01-A02",
          "description": "Validate ICDs completeness",
          "checks": [
            "All interfaces from interface_registry have ICDs",
            "ICDs include request/response schemas",
            "ICDs include error handling specifications",
            "ICDs include authentication/authorization requirements",
            "ICDs include versioning strategy"
          ]
        },
        {
          "action_id": "AV-01-A03",
          "description": "Create human-readable ICD documentation",
          "location_pattern": "specs/human/documentation/{interface_name}_interface.md",
          "purpose": "Developer-friendly interface documentation",
          "format": "Markdown with examples and usage patterns"
        }
      ],
      "tools_used": ["generate_interface_contracts.py"],
      "templates_used": ["interface_contract_complete_template.json"],
      "outputs": [
        "specs/machine/interfaces/{interface_name}_icd.json (per interface)",
        "specs/human/documentation/{interface_name}_interface.md (per interface)"
      ],
      "gates": [],
      "next_step": "AV-02"
    },
    {
      "step_id": "AV-02",
      "name": "Mermaid Diagrams & Visualizations",
      "description": "Generate Mermaid-based architecture diagrams and visualizations",
      "phase": "visualization",
      "step_file": "workflow_steps/artifacts_visualization/AV-02-MermaidDiagrams.json",
      "maps_from": "Arch-06: Visualization generation",
      "when_to_use": "Only if user plans to develop the system",
      "actions": [
        {
          "action_id": "AV-02-A01",
          "description": "Generate system architecture diagram (Mermaid)",
          "location": "specs/human/visualizations/system_architecture.mmd",
          "diagram_type": "Component diagram showing all services and their relationships",
          "source_data": "specs/machine/graphs/system_of_systems_graph.json"
        },
        {
          "action_id": "AV-02-A02",
          "description": "Generate service-level component diagrams (Mermaid)",
          "location_pattern": "specs/human/visualizations/{service_name}_components.mmd",
          "diagram_type": "Component diagram for each service showing internal components",
          "source_data": "specs/machine/service_arch/{service}/service_architecture_v*.json"
        },
        {
          "action_id": "AV-02-A03",
          "description": "Generate sequence diagrams (Mermaid)",
          "location_pattern": "specs/human/visualizations/{scenario_name}_sequence.mmd",
          "diagram_type": "Sequence diagrams for key user scenarios",
          "source_data": ["docs/USER_SCENARIOS.md", "specs/machine/interface_registry.json"]
        },
        {
          "action_id": "AV-02-A04",
          "description": "Generate deployment diagram (Mermaid)",
          "location": "specs/human/visualizations/deployment_architecture.mmd",
          "diagram_type": "Deployment diagram showing infrastructure and deployment topology",
          "source_data": "deployment_architecture sections from service_architecture.json files"
        },
        {
          "action_id": "AV-02-A05",
          "description": "Generate data flow diagrams (Mermaid)",
          "location_pattern": "specs/human/visualizations/{flow_name}_dataflow.mmd",
          "diagram_type": "Data flow diagrams showing how data moves through the system",
          "source_data": ["specs/machine/interface_registry.json", "service_architecture.json data_models"]
        },
        {
          "action_id": "AV-02-A06",
          "description": "Optional: Render Mermaid diagrams to PNG/SVG",
          "purpose": "Create static image exports for documentation",
          "tool_suggestion": "mermaid-cli (mmdc) or similar",
          "output_pattern": "specs/human/visualizations/{diagram_name}.png"
        }
      ],
      "tools_used": [],
      "templates_used": ["architecture_visualization_template.json"],
      "outputs": [
        "specs/human/visualizations/*.mmd (multiple Mermaid diagram files)",
        "specs/human/visualizations/*.png (optional - rendered diagrams)"
      ],
      "gates": [],
      "next_step": "AV-03"
    },
    {
      "step_id": "AV-03",
      "name": "Human-Readable Documentation",
      "description": "Generate comprehensive human-readable architecture documentation",
      "phase": "documentation",
      "step_file": "workflow_steps/artifacts_visualization/AV-03-Documentation.json",
      "maps_from": "Arch-06: Documentation generation",
      "when_to_use": "Only if user plans to develop the system",
      "actions": [
        {
          "action_id": "AV-03-A01",
          "description": "Generate architecture summary report",
          "location": "specs/human/reports/ARCHITECTURE_SUMMARY.md",
          "includes": [
            "System overview",
            "Service breakdown with responsibilities",
            "Key architectural decisions",
            "Technology stack",
            "Deployment strategy"
          ]
        },
        {
          "action_id": "AV-03-A02",
          "description": "Generate VERSIONED per-service human-readable documentation",
          "versioning": {
            "filename_format": "system_description_v{major}.{minor}.{patch}-{YYYYMMDD}.md",
            "must_match_architecture_version": true,
            "pairing_rule": "MUST create human doc for EVERY architecture version",
            "example": "system_description_v1.0.0-20251024.md (pairs with service_architecture_v1.0.0-20251024.json)"
          },
          "location_pattern": "specs/human/service_arch/{service_name}/system_description_v{version}-{YYYYMMDD}.md",
          "symlink_creation": {
            "create": "system_description.md",
            "points_to": "system_description_v{latest_version}-{YYYYMMDD}.md",
            "purpose": "Easy access to latest human-readable docs",
            "command": "ln -s system_description_v{version}-{date}.md system_description.md"
          },
          "translation_source": "Translate from service_architecture_v{version}-{YYYYMMDD}.json (same version)",
          "preservation_rule": "NEVER delete old versions - maintain complete documentation history",
          "includes": [
            "Service purpose and responsibilities (plain English)",
            "Component breakdown (non-technical explanation)",
            "Interface specifications (with examples and use cases)",
            "Data models (human-readable descriptions)",
            "Deployment requirements (clear language)",
            "Architecture decisions and rationale",
            "Version history and what changed from previous version"
          ],
          "format_requirements": [
            "Written for human consumption, not machines",
            "Use clear, non-jargon language where possible",
            "Include examples and diagrams where helpful",
            "Explain WHY not just WHAT",
            "Cross-reference to machine-readable architecture"
          ]
        },
        {
          "action_id": "AV-03-A03",
          "description": "Create Architecture Context Summary",
          "template": "architecture_context_summary_template.json",
          "location": "docs/ARCHITECTURE_CONTEXT_SUMMARY.md",
          "purpose": "High-level architecture overview for LLM agents and developers",
          "includes": [
            "System purpose",
            "Service map",
            "Key design decisions",
            "Integration patterns"
          ]
        },
        {
          "action_id": "AV-03-A04",
          "description": "Generate Architecture Decision Records (ADRs)",
          "location_pattern": "specs/human/documentation/adr/ADR-{number}-{title}.md",
          "purpose": "Document key architectural decisions with context and rationale",
          "template_structure": "ADR template (Context, Decision, Consequences)"
        },
        {
          "action_id": "AV-03-A05",
          "description": "Create development handoff documentation",
          "location": "specs/human/documentation/DEVELOPMENT_HANDOFF.md",
          "includes": [
            "How to use the architecture artifacts",
            "Service implementation order",
            "Interface contract references",
            "Testing strategy",
            "Deployment guidance"
          ]
        }
      ],
      "tools_used": [],
      "templates_used": ["architecture_context_summary_template.json"],
      "outputs": [
        "specs/human/reports/ARCHITECTURE_SUMMARY.md",
        "specs/human/service_arch/{service}_architecture.md (per service)",
        "docs/ARCHITECTURE_CONTEXT_SUMMARY.md",
        "specs/human/documentation/adr/*.md (ADRs)",
        "specs/human/documentation/DEVELOPMENT_HANDOFF.md"
      ],
      "gates": [
        {
          "gate_id": "G-AV-03",
          "name": "Documentation Completeness Gate",
          "checks": [
            "Architecture summary report complete",
            "All services have human-readable documentation",
            "Architecture Context Summary created",
            "Development handoff documentation exists"
          ],
          "blocking": false
        }
      ],
      "next_step": "complete"
    },
    {
      "step_id": "AV-04",
      "name": "Architecture-Only Handoff Package",
      "description": "Create minimal handoff package for architecture-only delivery",
      "phase": "handoff",
      "step_file": "workflow_steps/artifacts_visualization/AV-04-ArchitectureOnlyHandoff.json",
      "maps_from": "architecture_only_completion route from decision_flow.json",
      "when_to_use": "Only if user chose architecture-only (no development)",
      "actions": [
        {
          "action_id": "AV-04-A01",
          "description": "Generate minimal architecture summary",
          "location": "specs/human/reports/ARCHITECTURE_HANDOFF.md",
          "includes": [
            "System overview",
            "Service breakdown",
            "Key architectural decisions",
            "Machine-readable artifact locations"
          ]
        },
        {
          "action_id": "AV-04-A02",
          "description": "Create basic system architecture diagram",
          "location": "specs/human/visualizations/system_overview.mmd",
          "diagram_type": "High-level system component diagram",
          "purpose": "Visual overview for stakeholders"
        },
        {
          "action_id": "AV-04-A03",
          "description": "Package architecture artifacts",
          "purpose": "Prepare complete architecture package for handoff",
          "includes": [
            "All machine-readable artifacts (specs/machine/)",
            "Architecture summary and diagram",
            "Foundational documents (docs/)",
            "README with artifact guide"
          ]
        },
        {
          "action_id": "AV-04-A04",
          "description": "Optional: Export to GitHub repository",
          "tool": "export_system_to_github.py",
          "command_pattern": "python3 {reflow_root}/tools/export_system_to_github.py {system_root}",
          "purpose": "Create separate GitHub repository with architecture artifacts",
          "when_to_use": "If user wants to share architecture via GitHub"
        }
      ],
      "tools_used": ["export_system_to_github.py (optional)"],
      "outputs": [
        "specs/human/reports/ARCHITECTURE_HANDOFF.md",
        "specs/human/visualizations/system_overview.mmd",
        "Optional: GitHub repository export"
      ],
      "gates": [],
      "next_step": "complete",
      "skip_next_workflow": true,
      "note": "Workflow ends here for architecture-only delivery"
    }
  ],
  "completion": {
    "description": "Artifacts & visualization workflow complete",
    "outputs_summary_full": [
      "Interface Contract Documents (ICDs) for all interfaces",
      "Mermaid diagrams (system, service, sequence, deployment, data flow)",
      "Human-readable architecture documentation",
      "Architecture summary reports",
      "Architecture Decision Records (ADRs)",
      "Development handoff documentation"
    ],
    "outputs_summary_architecture_only": [
      "Architecture handoff summary",
      "Basic system overview diagram",
      "Optional GitHub export"
    ],
    "next_workflow": "03-development",
    "next_workflow_condition": "Only if user chose to develop (not architecture-only)",
    "transition_command": "workflow_driver.py {system_root} --next-workflow"
  },
  "llm_agent_guidance": {
    "critical_reminders": [
      "ALWAYS ask user if they plan to develop or want architecture-only (step AV-00-decision)",
      "For development: generate ALL artifacts (ICDs, diagrams, documentation)",
      "For architecture-only: generate minimal handoff package only",
      "Mermaid diagrams should be generated from machine-readable artifacts, not created manually",
      "Use generate_interface_contracts.py for ICDs, don't create them manually"
    ],
    "common_mistakes": [
      "Generating all artifacts even when user chose architecture-only (wasteful)",
      "Creating Mermaid diagrams manually instead of deriving from architecture",
      "Skipping interface contract documents",
      "Not creating Architecture Context Summary",
      "Forgetting to ask the development intent question"
    ],
    "workflow_branches": {
      "full_development": "Execute AV-01 → AV-02 → AV-03 → complete → 03-development",
      "architecture_only": "Execute AV-00-decision → AV-04 → complete (END)"
    }
  }
}
