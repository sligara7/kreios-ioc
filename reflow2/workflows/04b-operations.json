{
  "workflow_metadata": {
    "workflow_id": "04b-operations",
    "name": "Operations Workflow",
    "version": "3.7.0",
    "description": "CI/CD setup, deployment, monitoring, and as-fielded architecture tracking",
    "created_from": "04-testing_operations.json v1.0.0 - TO-02, TO-03, TO-04, TO-06 extracted",
    "last_updated": "2025-10-27",
    "purpose": "Deploy and operate system in production",
    "context_reduction": "Reduced from 776 lines to ~450 lines (42% reduction)",
    "contains_v3_5_0_feature": "TO-06 As-Fielded Architecture Lifecycle Tracking"
  },
  "prerequisites": {
    "required_workflows": [
      "03-development",
      "04a-testing"
    ],
    "required_files": [
      "context/working_memory.json",
      "specs/machine/service_arch/ (service architecture files)",
      "services/ (implemented and tested services)"
    ]
  },
  "workflow_steps": [
    {
      "step_id": "TO-02",
      "name": "CI/CD Setup & Automation",
      "description": "Set up continuous integration and deployment pipelines",
      "phase": "automation",
      "step_file": "workflow_steps/testing_operations/TO-02-CICDSetup.json",
      "maps_from": "Dev-06: CI/CD & Deployment",
      "actions": [
        {
          "action_id": "TO-02-A01",
          "description": "Create CI pipeline configuration",
          "platforms": [
            "GitHub Actions",
            "GitLab CI",
            "Jenkins",
            "CircleCI",
            "Azure DevOps"
          ],
          "location_pattern": ".github/workflows/ci.yml or .gitlab-ci.yml or Jenkinsfile",
          "pipeline_stages": [
            "Build (compile, package)",
            "Test (unit, integration)",
            "Lint & format check",
            "Security scan",
            "Coverage report"
          ]
        },
        {
          "action_id": "TO-02-A02",
          "description": "Create CD pipeline configuration",
          "pipeline_stages": [
            "Build container images",
            "Push to container registry",
            "Deploy to staging",
            "Run smoke tests",
            "Deploy to production (manual approval)"
          ]
        },
        {
          "action_id": "TO-02-A03",
          "description": "Create Dockerfiles for each service",
          "location_pattern": "services/{service_name}/Dockerfile",
          "best_practices": [
            "Multi-stage builds",
            "Minimal base images",
            "Non-root user",
            "Health check instruction"
          ]
        },
        {
          "action_id": "TO-02-A04",
          "description": "Create container image build scripts",
          "purpose": "Automate container image creation",
          "versioning": "Use semantic versioning for images"
        },
        {
          "action_id": "TO-02-A05",
          "description": "Configure automated quality gates",
          "gates": [
            "Test coverage threshold (80%)",
            "Linting passes",
            "Security vulnerabilities threshold",
            "Code complexity threshold"
          ]
        },
        {
          "action_id": "TO-02-A06",
          "description": "Set up deployment automation",
          "methods": [
            "Kubernetes manifests",
            "Helm charts",
            "Terraform/CloudFormation",
            "Docker Compose (staging)"
          ]
        }
      ],
      "tools_used": [
        "Docker",
        "CI/CD platform",
        "Container registry"
      ],
      "outputs": [
        "CI/CD pipeline configurations",
        "services/{service_name}/Dockerfile (per service)",
        "Deployment manifests",
        "Container images"
      ],
      "gates": [],
      "next_step": "TO-03"
    },
    {
      "step_id": "TO-03",
      "name": "Deployment Validation",
      "description": "Validate deployment artifacts and local deployment",
      "phase": "deployment",
      "step_file": "workflow_steps/testing_operations/TO-03-DeploymentValidation.json",
      "maps_from": "Dev-06: Deployment validation",
      "actions": [
        {
          "action_id": "TO-03-A01",
          "description": "Create Docker Compose file for local deployment",
          "location": "docker-compose.yml or services/docker-compose.yml",
          "purpose": "Enable local multi-service deployment",
          "includes": [
            "All services",
            "Databases",
            "Message queues",
            "Networking configuration",
            "Volume mounts"
          ]
        },
        {
          "action_id": "TO-03-A02",
          "description": "Validate Docker Compose deployment",
          "commands": [
            "docker-compose up -d",
            "docker-compose ps (verify all healthy)",
            "docker-compose logs (check for errors)",
            "docker-compose down"
          ],
          "purpose": "Ensure all services start and communicate correctly",
          "gate_enforcement": "Block if Docker Compose deployment fails"
        },
        {
          "action_id": "TO-03-A03",
          "description": "Run smoke tests on Docker Compose deployment",
          "test_types": [
            "Health check endpoints (/health, /ready)",
            "Basic API functionality",
            "Service-to-service communication",
            "Database connectivity"
          ],
          "purpose": "Verify basic functionality in deployed environment"
        },
        {
          "action_id": "TO-03-A04",
          "description": "Validate deployment manifests",
          "manifests": [
            "Kubernetes YAML",
            "Helm charts",
            "Terraform"
          ],
          "validation": [
            "Syntax validation",
            "Resource limits defined",
            "Health checks configured",
            "Environment variables set"
          ]
        },
        {
          "action_id": "TO-03-A05",
          "description": "Test deployment to staging environment",
          "purpose": "Validate deployment process in real environment",
          "success_criteria": "All services deploy and pass health checks"
        }
      ],
      "tools_used": [
        "Docker",
        "Docker Compose",
        "kubectl (if using Kubernetes)"
      ],
      "outputs": [
        "docker-compose.yml",
        "Validated deployment manifests",
        "Smoke test results"
      ],
      "gates": [
        {
          "gate_id": "G-TO-03",
          "name": "Deployment Validation Gate",
          "checks": [
            "Docker Compose deployment successful",
            "All services healthy in Docker Compose",
            "Smoke tests passing",
            "Deployment manifests validated"
          ],
          "blocking": true
        }
      ],
      "next_step": "TO-04"
    },
    {
      "step_id": "TO-04",
      "name": "Operational Readiness",
      "description": "Prepare for production operations with runbooks and procedures",
      "phase": "operations",
      "step_file": "workflow_steps/testing_operations/TO-04-OperationalReadiness.json",
      "maps_from": "Dev-07: Operational Readiness & Runbooks",
      "actions": [
        {
          "action_id": "TO-04-A01",
          "description": "Create operational runbooks",
          "location": "docs/runbooks/",
          "runbooks": [
            "Deployment procedure",
            "Rollback procedure",
            "Incident response",
            "Troubleshooting guide",
            "Scaling procedure",
            "Backup and recovery"
          ]
        },
        {
          "action_id": "TO-04-A02",
          "description": "Document monitoring and alerting",
          "includes": [
            "Key metrics to monitor",
            "Alert thresholds",
            "Alert routing (who gets notified)",
            "Dashboard links"
          ],
          "location": "docs/runbooks/MONITORING.md"
        },
        {
          "action_id": "TO-04-A03",
          "description": "Create operational checklists",
          "checklists": [
            "Pre-deployment checklist",
            "Post-deployment verification",
            "Incident response checklist",
            "Rollback checklist"
          ],
          "location": "docs/runbooks/CHECKLISTS.md"
        },
        {
          "action_id": "TO-04-A04",
          "description": "Configure monitoring and alerting",
          "monitoring": [
            "Application metrics (Prometheus/Grafana)",
            "Infrastructure metrics (CPU, memory, disk)",
            "Log aggregation (ELK, Splunk, CloudWatch)",
            "Distributed tracing (Jaeger, Zipkin)"
          ],
          "alerts": [
            "Service down alerts",
            "High error rate alerts",
            "Performance degradation alerts",
            "Resource exhaustion alerts"
          ]
        },
        {
          "action_id": "TO-04-A05",
          "description": "Define SLIs, SLOs, and SLAs",
          "definitions": [
            "SLI (Service Level Indicators): What you measure",
            "SLO (Service Level Objectives): Target values",
            "SLA (Service Level Agreements): Commitments to users"
          ],
          "examples": [
            "Availability SLO: 99.9% uptime",
            "Latency SLO: p95 < 200ms",
            "Error rate SLO: < 0.1%"
          ],
          "location": "docs/SLO.md"
        },
        {
          "action_id": "TO-04-A06",
          "description": "Conduct operational readiness review",
          "review_areas": [
            "Runbooks complete and tested",
            "Monitoring and alerting configured",
            "On-call rotation established",
            "Incident response process defined",
            "Disaster recovery plan documented"
          ]
        }
      ],
      "tools_used": [
        "Monitoring platforms",
        "Alerting systems"
      ],
      "outputs": [
        "docs/runbooks/ (multiple runbook documents)",
        "docs/SLO.md",
        "Monitoring dashboards",
        "Alert configurations"
      ],
      "gates": [
        {
          "gate_id": "G-TO-04",
          "name": "Operational Readiness Gate",
          "checks": [
            "All critical runbooks created",
            "Monitoring configured",
            "Alerting configured",
            "SLOs defined",
            "Operational readiness review complete"
          ],
          "blocking": false
        }
      ],
      "next_step": "TO-06"
    },
    {
      "step_id": "TO-06",
      "name": "As-Fielded Architecture Capture",
      "description": "Generate as-fielded architecture from deployed system and compare to as-designed",
      "phase": "validation",
      "step_file": "workflow_steps/testing_operations/TO-06-AsFieldedArchitecture.json",
      "actions": [
        {
          "action_id": "TO-06-A01",
          "description": "Generate as-fielded architecture graph",
          "tool": "generate_as_fielded_architecture.py",
          "command_pattern": "python3 {reflow_root}/tools/generate_as_fielded_architecture.py --system-root {system_root} --output specs/machine/graphs/system_of_systems_graph_as_fielded.json --compare-to specs/machine/graphs/system_of_systems_graph.json --environment {environment}",
          "purpose": "Capture actual deployed system architecture from runtime inspection",
          "method": "Docker runtime inspection + docker-compose analysis",
          "detects": [
            "Running containers and their status",
            "Actual port mappings",
            "Health endpoint status",
            "Network topology",
            "Service dependencies (from docker-compose)",
            "Resource usage"
          ],
          "environment_values": [
            "dev",
            "staging",
            "production"
          ],
          "outputs": [
            "specs/machine/graphs/system_of_systems_graph_as_fielded.json"
          ]
        },
        {
          "action_id": "TO-06-A02",
          "description": "Compare as-fielded to as-designed architecture",
          "tool": "compare_architectures.py",
          "command_pattern": "python3 {reflow_root}/tools/compare_architectures.py --from specs/machine/graphs/system_of_systems_graph.json --to specs/machine/graphs/system_of_systems_graph_as_fielded.json --output specs/machine/graphs/architecture_delta_designed_to_fielded_{date}.json",
          "purpose": "Identify architectural deviations from design in deployed system",
          "note": "This runs automatically as part of TO-06-A01 (--compare-to flag)",
          "analyzes": [
            "Services not running (should be running)",
            "Unexpected services (not in design)",
            "Port conflicts or changes",
            "Network topology differences",
            "Health check failures",
            "Similarity score (Jaccard similarity)",
            "Breaking vs non-breaking changes"
          ],
          "outputs": [
            "specs/machine/graphs/architecture_delta_designed_to_fielded_{date}.json"
          ]
        },
        {
          "action_id": "TO-06-A03",
          "description": "Compare as-fielded to as-built architecture",
          "tool": "compare_architectures.py",
          "command_pattern": "python3 {reflow_root}/tools/compare_architectures.py --from specs/machine/graphs/system_of_systems_graph_as_built.json --to specs/machine/graphs/system_of_systems_graph_as_fielded.json --output specs/machine/graphs/architecture_delta_built_to_fielded_{date}.json",
          "purpose": "Identify operational changes from implementation to deployment",
          "optional": "Only if as-built graph exists",
          "analyzes": [
            "Deployment-specific changes (ports, environment vars)",
            "Services scaled or removed for operations",
            "Configuration drift"
          ],
          "outputs": [
            "specs/machine/graphs/architecture_delta_built_to_fielded_{date}.json"
          ]
        },
        {
          "action_id": "TO-06-A04",
          "description": "Review delta reports and document operational rationale",
          "purpose": "Understand why deployed system differs from design and implementation",
          "process": [
            "Read architecture_delta_designed_to_fielded_{date}.json",
            "Read architecture_delta_built_to_fielded_{date}.json (if exists)",
            "Review breaking_changes and non_breaking_changes",
            "For each significant change, document operational rationale",
            "Decide: update design OR fix deployment OR accept drift"
          ],
          "decision_criteria": {
            "update_design_if": [
              "Operational constraints not known during design",
              "Production environment requires different architecture",
              "Scalability requirements changed"
            ],
            "fix_deployment_if": [
              "Configuration drift introduced bugs",
              "Security controls missing or misconfigured",
              "Services not deployed as intended"
            ],
            "accept_drift_if": [
              "Environment-specific configuration (expected)",
              "Temporary workarounds for production issues",
              "Optimization for operational efficiency"
            ]
          },
          "output_location": "docs/AS_FIELDED_ARCHITECTURE_RATIONALE.md"
        },
        {
          "action_id": "TO-06-A05",
          "description": "Update as-designed architecture for operational insights",
          "conditional": "If delta analysis reveals design should incorporate fielded learnings",
          "process": [
            "Update service_architecture.json files with operational insights",
            "Regenerate system_of_systems_graph.json",
            "Update operational runbooks if architecture changed",
            "Document changes in version_manifest.json"
          ],
          "purpose": "Feed operational experience back into design phase (continuous improvement)"
        },
        {
          "action_id": "TO-06-A06",
          "description": "Create architecture lifecycle summary",
          "purpose": "Document complete architecture evolution: designed \u2192 built \u2192 fielded",
          "output_file": "docs/ARCHITECTURE_LIFECYCLE_SUMMARY.md",
          "includes": [
            "Summary of as-designed architecture",
            "Summary of as-built changes and rationale",
            "Summary of as-fielded changes and rationale",
            "Similarity scores (designed vs built, designed vs fielded, built vs fielded)",
            "Lessons learned for future systems",
            "Recommendations for next iteration"
          ]
        }
      ],
      "tools_used": [
        "generate_as_fielded_architecture.py",
        "compare_architectures.py"
      ],
      "outputs": [
        "specs/machine/graphs/system_of_systems_graph_as_fielded.json",
        "specs/machine/graphs/architecture_delta_designed_to_fielded_{date}.json",
        "specs/machine/graphs/architecture_delta_built_to_fielded_{date}.json",
        "docs/AS_FIELDED_ARCHITECTURE_RATIONALE.md",
        "docs/ARCHITECTURE_LIFECYCLE_SUMMARY.md"
      ],
      "gates": [
        {
          "gate_id": "G-TO-06",
          "name": "As-Fielded Architecture Validation",
          "checks": [
            "As-fielded graph generated successfully",
            "All deployed services healthy",
            "Delta reports created",
            "Similarity score >= 0.6 (60% match to designed architecture)",
            "All critical deviations documented with rationale",
            "Architecture lifecycle summary complete"
          ],
          "blocking": false,
          "note": "Non-blocking to allow operational flexibility while maintaining architectural awareness"
        }
      ]
    }
  ],
  "quality_gates": {
    "gates": []
  },
  "next_workflow": null,
  "completion_note": "System deployed and operational. Use feature_update.json for future changes."
}