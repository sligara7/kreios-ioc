{
  "workflow_metadata": {
    "version": "0.1.0",
    "name": "Dev-02 Core & Domain Model Realization",
    "based_on": "service_development_workflow.json D2â€“D3",
    "description": "Transform architectural skeleton into concrete code foundations and core domain logic."
  },
  "entry_conditions": {
    "from": "Dev-01",
    "artifacts": ["context/dev_progress_tracker.json", "specs/machine/index.json"]
  },
  "steps": [
    { "id": "D2.1", "description": "Generate directory skeleton for each service (dependency order)", "tool": "bash", "output": "code/<service>/" },
    { "id": "D2.2", "description": "Instantiate data models from specs/machine/service_arch/<service>/data_models.json", "tool": "manual" },
    { "id": "D2.3", "description": "Create placeholder interface adapters aligning with api_contracts.json", "tool": "manual" },
    { "id": "D2.4", "description": "Add configuration loader honoring infrastructure.json", "tool": "manual" },
    { "id": "D2.5", "description": "Register DI graph if applicable", "tool": "manual" },
    { "id": "D2.6", "description": "Initial lint & type pass", "tool": "bash" },
    { "id": "D3.1", "description": "Rank use cases and implement domain services (pure logic first)", "tool": "manual" },
    { "id": "D3.2", "description": "Wire API handlers to domain services per api_contracts.json", "tool": "manual" },
    { "id": "D3.3", "description": "Enforce validation and auth policies per compliance.json", "tool": "manual" }
  ],
  "artifact_routing": {
    "code": "code/<service>/",
    "machine_specs": "specs/machine/service_arch/<service>/",
    "context": "context/*"
  },
  "iteration_paths": {
    "on_contract_change": "../feature_update/FU-02-ArchReengineering.json",
    "on_spec_misalignment": "../architecture/Arch-05-ConsistencyAndSpecVerification.json"
  },
  "validation": {
    "exit_criteria": ["API surface placeholders exist", "Data structures match data_models.json", "Config bootstrap operational"],
    "quality_gates": {
      "architecture_validation": {
        "tool": "python3 <reflow_path>/tools/validate_architecture.py <system_path>",
        "blocking": true,
        "description": "Validates service architectures match templates and have consistent interfaces",
        "success_criteria": "All service architectures pass validation with no errors"
      },
      "docker_compose_integration": {
        "tool": "docker-compose up --build -d && docker-compose ps && docker-compose down",
        "blocking": true,
        "description": "Verifies all services can start successfully in containerized environment",
        "success_criteria": "All services reach 'running' status within startup timeout",
        "timeout_seconds": 300,
        "validation_steps": [
          "Build all service containers",
          "Start services with docker-compose",
          "Verify all services report 'running' status",
          "Check service health endpoints if available",
          "Collect logs from any failed services",
          "Clean up with docker-compose down"
        ]
      },
      "interface_consistency": {
        "description": "Ensures all service interfaces are properly registered and consistent",
        "blocking": true,
        "checks": [
          "All endpoints defined in api_contracts.json are implemented",
          "All interface contracts exist in specs/machine/interfaces/",
          "No orphaned interface definitions"
        ]
      },
      "auto_progress_detection": {
        "description": "Automatically detect which Dev-02 actions are complete by scanning code",
        "enabled": true,
        "checks": {
          "D2.1": "check_directory_skeleton(service_path)",
          "D2.2": "check_models_exist(service_path)",
          "D2.3": "check_routers_exist(service_path)",
          "D2.4": "check_config_loader(service_path)",
          "D2.5": "check_di_setup(service_path)",
          "D2.6": "check_lint_pass(service_path)"
        }
      }
    },
    "on_validation_failure": {
      "action": "BLOCK",
      "message": "Cannot proceed to Dev-03. Fix validation issues first.",
      "remediation_steps": [
        "Review validation error output",
        "Fix identified issues in service code or architecture",
        "Re-run validation: python3 workflow_driver.py <system> --validate",
        "Only proceed when all validation gates pass"
      ]
    }
  },
  "handoff": {
    "produces": ["code/<service>/", "updated dev_process_log.md"],
    "next_workflow": "../development/Dev-03-Persistence.json"
  }
}
